class MenuNestable{constructor(){this.$nestable=$("#nestable")}setDataItem(t){t.each((t,e)=>{let a=$(e);a.data("id",a.attr("data-id")),a.data("title",a.attr("data-title")),a.data("reference-id",a.attr("data-reference-id")),a.data("reference-type",a.attr("data-reference-type")),a.data("custom-url",a.attr("data-custom-url")),a.data("class",a.attr("data-class")),a.data("target",a.attr("data-target"))})}updatePositionForSerializedObj(t){let e=t,a=this;return $.each(e,(t,e)=>{e.position=t,void 0===e.children&&(e.children=[]),a.updatePositionForSerializedObj(e.children)}),e}init(){let t=parseInt(this.$nestable.attr("data-depth"));t<1&&(t=5),$(".nestable-menu").nestable({group:1,maxDepth:t,expandBtnHTML:"",collapseBtnHTML:""}),this.handleNestableMenu()}handleNestableMenu(){let t=this;$(document).on("click",".dd-item .dd3-content a.show-item-details",t=>{t.preventDefault();let e=$(t.currentTarget).parent().parent();$(t.currentTarget).toggleClass("active"),e.toggleClass("active")}),$(document).on("change blur keyup",'.nestable-menu .item-details input[type="text"], .nestable-menu .item-details select',e=>{e.preventDefault();let a=$(e.currentTarget),l=a.closest("li.dd-item");l.attr("data-"+a.attr("name"),a.val()),l.data(a.attr("name"),a.val()),l.find('> .dd3-content .text[data-update="'+a.attr("name")+'"]').text(a.val()),""===a.val().trim()&&l.find('> .dd3-content .text[data-update="'+a.attr("name")+'"]').text(a.attr("data-old")),t.setDataItem(t.$nestable.find("> ol.dd-list li.dd-item"))}),$(document).on("click",".box-links-for-menu .btn-add-to-menu",e=>{e.preventDefault();let a=$(e.currentTarget).parents(".the-box"),l="";if("external_link"===a.attr("id")){let t="custom-link",e=0,n=$("#node-title").val(),s=$("#node-url").val(),d=$("#node-css").val(),i=$("#node-icon").val(),o=$("#target").find("option:selected").val();l+='<li data-reference-type="'+t+'" data-reference-id="'+e+'" data-title="'+n+'" data-class="'+d+'" data-id="0" data-custom-url="'+s+'" data-icon-font="'+i+'" data-target="'+o+'" class="dd-item dd3-item">',l+='<div class="dd-handle dd3-handle"></div>',l+='<div class="dd3-content">',l+='<span class="text float-left" data-update="title">'+n+"</span>",l+='<span class="text float-right">'+t+"</span>",l+='<a href="#" class="show-item-details"><i class="fa fa-angle-down"></i></a>',l+='<div class="clearfix"></div>',l+="</div>",l+='<div class="item-details">',l+='<label class="pad-bot-5">',l+='<span class="text pad-top-5 dis-inline-block" data-update="title">Title</span>',l+='<input type="text" data-old="'+n+'" value="'+n+'" name="title" class="form-control">',l+="</label>",l+='<label class="pad-bot-5"><span class="text pad-top-5 dis-inline-block" data-update="custom-url">Url</span><input type="text" data-old="'+s+'" value="'+s+'" name="custom-url"></label>',l+='<label class="pad-bot-5 dis-inline-block"><span class="text pad-top-5" data-update="icon-font">Icon - font</span><input type="text" name="icon-font" value="'+i+'" data-old="'+i+'" class="form-control"></label>',l+='<label class="pad-bot-10">',l+='<span class="text pad-top-5 dis-inline-block" data-update="class">CSS class</span>',l+='<input type="text" data-old="'+d+'" value="'+d+'" name="class" class="form-control">',l+="</label>",l+='<label class="pad-bot-10">',l+='<span class="text pad-top-5 dis-inline-block" data-update="target">Target</span>',l+='<div style="width: 228px; display: inline-block"><select name="target" id="target" data-old="'+o+'" class="form-control select-full">',l+='<option value="_self">Open link directly</option>',l+='<option value="_blank" '+("_blank"===o?'selected="selected"':"")+">Open link in new tab</option>",l+="</select></div>",l+="</label>",l+='<div class="text-right">',l+='<a class="btn red btn-remove" href="#">Remove</a>',l+='<a class="btn blue btn-cancel" href="#">Cancel</a>',l+="</div>",l+="</div>",l+='<div class="clearfix"></div>',l+="</li>",a.find('input[type="text"]').val("")}else a.find(".list-item li.active").each((t,e)=>{let a=$(e).find("> label"),n=a.attr("data-reference-type"),s=a.attr("data-reference-id"),d=a.attr("data-title");l+='<li data-reference-type="'+n+'" data-reference-id="'+s+'" data-title="'+d+'" data-id="0" data-target="_self" class="dd-item dd3-item">',l+='<div class="dd-handle dd3-handle"></div>',l+='<div class="dd3-content">',l+='<span class="text float-left" data-update="title">'+d+"</span>",l+='<span class="text float-right">'+n+"</span>",l+='<a href="#" class="show-item-details"><i class="fa fa-angle-down"></i></a>',l+='<div class="clearfix"></div>',l+="</div>",l+='<div class="item-details">',l+='<label class="pad-bot-5">',l+='<span class="text pad-top-5 dis-inline-block" data-update="title">Title</span>',l+='<input type="text" data-old="'+d+'" value="'+d+'" name="title" class="form-control">',l+="</label>",l+='<label class="pad-bot-5 dis-inline-block"><span class="text pad-top-5" data-update="icon-font">Icon - font</span><input type="text" name="icon-font" class="form-control"></label>',l+='<label class="pad-bot-10">',l+='<span class="text pad-top-5 dis-inline-block" data-update="class">CSS class</span>',l+='<input type="text" name="class" class="form-control">',l+="</label>",l+='<label class="pad-bot-10">',l+='<span class="text pad-top-5 dis-inline-block" data-update="target">Target</span>',l+='<div style="width: 228px; display: inline-block"><select name="target" id="target" class="form-control select-full">',l+='<option value="_self">Open link directly</option>',l+='<option value="_blank">Open link in new tab</option>',l+="</select></div>",l+="</label>",l+='<div class="text-right">',l+='<a class="btn red btn-remove" href="#">Remove</a>',l+='<a class="btn blue btn-cancel" href="#">Cancel</a>',l+="</div>",l+="</div>",l+='<div class="clearfix"></div>',l+="</li>",$(e).find("input[type=checkbox]").prop("checked",!1)});$(".nestable-menu > ol.dd-list").append(l),$(".nestable-menu").find(".select-full").select2({width:"100%",minimumResultsForSearch:-1}),t.setDataItem(t.$nestable.find("> ol.dd-list li.dd-item")),a.find(".list-item li.active").removeClass("active")}),$(document).on("click",".box-links-for-menu1 .btn-add-to-menu1",e=>{e.preventDefault();let a=$(e.currentTarget).parents(".the-box1"),l="",n=$("#node-title1").val(),s=$("#node-url1").val(),d=$("#node-css1").val(),i=$("#node-icon1").val(),o=$("#target1").find("option:selected").val();l+='<li data-reference-type="custom-link" data-reference-id="0" data-title="'+n+'" data-class="'+d+'" data-id="0" data-custom-url="'+s+'" data-icon-font="'+i+'" data-target="'+o+'" class="dd-item dd3-item">',l+='<div class="dd-handle dd3-handle"></div>',l+='<div class="dd3-content">',l+='<span class="text float-left" data-update="title">'+n+"</span>",l+='<span class="text float-right">custom-link</span>',l+='<a href="#" class="show-item-details"><i class="fa fa-angle-down"></i></a>',l+='<div class="clearfix"></div>',l+="</div>",l+='<div class="item-details">',l+='<label class="pad-bot-5">',l+='<span class="text pad-top-5 dis-inline-block" data-update="title">Title</span>',l+='<input type="text" data-old="'+n+'" value="'+n+'" name="title" class="form-control">',l+="</label>",l+='<label class="pad-bot-5"><span class="text pad-top-5 dis-inline-block" data-update="custom-url">Url</span><input type="text" data-old="'+s+'" value="'+s+'" name="custom-url"></label>',l+='<label class="pad-bot-5 dis-inline-block"><span class="text pad-top-5" data-update="icon-font">Icon - font</span><input type="text" name="icon-font" value="'+i+'" data-old="'+i+'" class="form-control"></label>',l+='<label class="pad-bot-10">',l+='<span class="text pad-top-5 dis-inline-block" data-update="class">CSS class</span>',l+='<input type="text" data-old="'+d+'" value="'+d+'" name="class" class="form-control">',l+="</label>",l+='<label class="pad-bot-10">',l+='<span class="text pad-top-5 dis-inline-block" data-update="target">Target</span>',l+='<div style="width: 228px; display: inline-block"><select name="target" id="target" data-old="'+o+'" class="form-control select-full">',l+='<option value="_self">Open link directly</option>',l+='<option value="_blank" '+("_blank"===o?'selected="selected"':"")+">Open link in new tab</option>",l+="</select></div>",l+="</label>",l+='<div class="text-right">',l+='<a class="btn red btn-remove" href="#">Remove</a>',l+='<a class="btn blue btn-cancel" href="#">Cancel</a>',l+="</div>",l+="</div>",l+='<div class="clearfix"></div>',l+="</li>",$(".nestable-menu > ol.dd-list").append(l),$(".nestable-menu").find(".select-full").select2({width:"100%",minimumResultsForSearch:-1}),t.setDataItem(t.$nestable.find("> ol.dd-list li.dd-item")),a.find(".list-item li.active").removeClass("active")}),$('.form-save-menu input[name="deleted_nodes"]').val(""),$(document).on("click",".nestable-menu .item-details .btn-remove",t=>{t.preventDefault();let e=$(t.currentTarget).parents(".item-details").parent(),a=$('.form-save-menu input[name="deleted_nodes"]');a.val(a.val()+" "+e.attr("data-id"));let l=e.find("> .dd-list").html();""!==l&&null!=l&&e.before(l),e.remove()}),$(document).on("click",".nestable-menu .item-details .btn-cancel",t=>{t.preventDefault();let e=$(t.currentTarget).parents(".item-details").parent();e.find('input[type="text"]').each((t,e)=>{$(e).val($(e).attr("data-old"))}),e.find("select").each((t,e)=>{$(e).val($(e).val())}),e.find('input[type="text"]').trigger("change"),e.find("select").trigger("change"),e.removeClass("active")}),$(document).on("change",".box-links-for-menu .list-item li input[type=checkbox]",t=>{$(t.currentTarget).closest("li").toggleClass("active")}),$(document).on("submit",".form-save-menu",()=>{if(t.$nestable.length<1)$("#nestable-output").val("[]");else{let e=t.$nestable.nestable("serialize"),a=t.updatePositionForSerializedObj(e);$("#nestable-output").val(JSON.stringify(a))}});let e=$("#accordion"),a=t=>{$(t.target).prev(".widget-heading").find(".narrow-icon").toggleClass("fa-angle-down fa-angle-up")};e.on("hidden.bs.collapse",a),e.on("shown.bs.collapse",a),Botble.callScroll($(".list-item"))}}$(window).on("load",()=>{(new MenuNestable).init()});